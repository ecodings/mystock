<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï£ºÏãù Îß§Îß§ ÏùºÏßÄ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            font-size: 14px;
        }

        .header {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            color: #2c3e50;
        }

        .refresh-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .refresh-btn:hover {
            background: #2980b9;
        }

        .price-mode-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .price-mode-btn:hover {
            background: #7f8c8d;
        }

        .price-mode-btn.active {
            background: #27ae60;
        }

        .container {
            display: grid;
            grid-template-columns: 60% 40%;
            gap: 20px;
            padding: 0 20px 20px;
            height: calc(100dvh - 100px);
            height: calc(100vh - 100px);
            min-height: 0;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
            min-height: 0;
        }

        .left-panel > .panel:first-child {
            flex: 1 1 0;
            min-height: 0;
        }

        .left-panel > .panel.trade-history {
            flex: 0 0 35%;
            min-height: 0;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow: hidden;
            height: 100%;
            min-height: 0;
        }

        .panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow-y: auto;
            min-height: 0;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .accounts-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .account-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }

        .account-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #34495e;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .account-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: inline-block;
        }

        .account-icon.stock { background: #e74c3c; }
        .account-icon.etf { background: #3498db; }
        .account-icon.us { background: #27ae60; }

        .stock-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid #e9ecef;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stock-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stock-name {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stock-change {
            font-size: 13px;
            font-weight: 600;
        }

        .stock-change.positive { color: #e74c3c; }
        .stock-change.negative { color: #3498db; }

        .stock-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 12px;
            color: #6c757d;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
        }

        .detail-value {
            font-weight: 500;
            color: #495057;
        }

        .profit-loss {
            grid-column: span 2;
            margin-top: 5px;
            padding-top: 8px;
            border-top: 1px solid #e9ecef;
        }

        .profit-loss .detail-value {
            font-weight: 600;
        }

        .profit-loss.positive .detail-value { color: #e74c3c; }
        .profit-loss.negative .detail-value { color: #3498db; }

        .calendar-section {
            flex: 1 1 0;
            min-height: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex: 0 0 auto;
        }

        .filter-btn {
            background: #ecf0f1;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .filter-btn.active {
            background: #3498db;
            color: white;
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .month-nav-btn {
            background: #ecf0f1;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .month-nav-btn:hover {
            background: #d5dbdb;
        }

        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .current-stock-name {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            flex: 0 0 auto;
        }

        .calendar {
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: auto;
            flex: 1 1 0;
            min-height: 0;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            padding: 10px 0;
            background: #f8f9fa;
            border-radius: 4px;
            color: #7f8c8d;
        }

        .calendar-day {
            background: #f8f9fa;
            min-height: 80px;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        .calendar-day:hover {
            background: #e9ecef;
        }

        .calendar-day.other-month {
            opacity: 0.5;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .trade-info {
            font-size: 11px;
            margin-bottom: 2px;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .trade-info.buy {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .trade-info.sell {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        .calendar-summary {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            flex: 0 0 auto;
        }

        .summary-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .summary-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 20px;
            font-weight: 600;
        }

        .summary-value.buy {
            color: #e74c3c;
        }

        .summary-value.sell {
            color: #3498db;
        }

        .trade-history {
            /* left-panelÏóêÏÑú ÎπÑÏú®Î°ú Ï†úÏñ¥ */
        }

        .trade-history-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid;
            font-size: 12px;
        }

        .trade-history-item.buy { border-left-color: #e74c3c; }
        .trade-history-item.sell { border-left-color: #3498db; }

        .trade-date {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .trade-details {
            display: flex;
            justify-content: space-between;
            color: #6c757d;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex: 0 0 auto;
        }

        .tab-btn {
            flex: 1;
            background: #ecf0f1;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .tab-btn.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
            flex: 1;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        .donut-charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            flex: 1;
            min-height: 0;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }

        .donut-chart-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
        }

        .donut-chart-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .donut-chart {
            flex: 1;
            position: relative;
            min-height: 0;
        }

        .donut-chart canvas {
            max-width: 100%;
            max-height: 280px;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }

            .accounts-container {
                grid-template-columns: 1fr;
            }

            .donut-charts-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Ï£ºÏãù Îß§Îß§ ÏùºÏßÄ</h1>
        <div style="display:flex; gap:10px; align-items:center;">
            <button class="refresh-btn" onclick="refreshData()">üîÑ ÏÉàÎ°úÍ≥†Ïπ®</button>
        </div>
    </div>

    <div class="container">
        <div class="left-panel">
            <div class="panel">
                <div class="accounts-container" id="accountsContainer"></div>
            </div>

            <div class="panel trade-history">
                <div class="panel-title" id="tradeHistoryTitle">Ï¢ÖÎ™©Î≥Ñ Í±∞Îûò ÎÇ¥Ïó≠</div>
                <div id="tradeHistoryList"></div>
            </div>
        </div>

        <div class="right-panel">
            <div class="panel calendar-section">
                <div class="calendar-header">
                    <button class="filter-btn active" id="allFilterBtn" onclick="selectFilter('all')">Ï†ÑÏ≤¥</button>
                    <div class="date-selector">
                        <button class="month-nav-btn" onclick="prevMonth()">‚óÄ</button>
                        <select id="yearSelect" onchange="updateCalendar()"></select>
                        <select id="monthSelect" onchange="updateCalendar()"></select>
                        <button class="month-nav-btn" onclick="nextMonth()">‚ñ∂</button>
                    </div>
                </div>

                <div class="current-stock-name" id="currentStockName">Ï†ÑÏ≤¥</div>

                <div class="calendar">
                    <div class="calendar-grid">
                        <div class="calendar-day-header">Ïùº</div>
                        <div class="calendar-day-header">Ïõî</div>
                        <div class="calendar-day-header">Ìôî</div>
                        <div class="calendar-day-header">Ïàò</div>
                        <div class="calendar-day-header">Î™©</div>
                        <div class="calendar-day-header">Í∏à</div>
                        <div class="calendar-day-header">ÌÜ†</div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>

                <div class="calendar-summary">
                    <div class="summary-item">
                        <div class="summary-label">Ï¥ù Îß§ÏàòÏï°</div>
                        <div class="summary-value buy" id="totalBuy">0ÎßåÏõê</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Ï¥ù Îß§ÎèÑÏï°</div>
                        <div class="summary-value sell" id="totalSell">0ÎßåÏõê</div>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('stock')">Ï£ºÏãù</button>
                    <button class="tab-btn" onclick="showTab('etf')">ETF</button>
                    <button class="tab-btn" onclick="showTab('us')">ÎØ∏Íµ≠</button>
                </div>

                <div class="tab-content active" id="stockTab">
                    <div class="donut-charts-container">
                        <div class="donut-chart-item">
                            <div class="donut-chart-title">Ï¢ÖÎ™©</div>
                            <div class="donut-chart">
                                <canvas id="stockDonutChart"></canvas>
                            </div>
                        </div>
                        <div class="donut-chart-item">
                            <div class="donut-chart-title">ÏàòÏùµ</div>
                            <div class="donut-chart">
                                <canvas id="stockProfitChart"></canvas>
                            </div>
                        </div>
                        <div class="donut-chart-item">
                            <div class="donut-chart-title">ÎπÑÏ§ë</div>
                            <div class="donut-chart">
                                <canvas id="stockRatioChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="etfTab">
                    <div class="donut-charts-container">
                        <div class="donut-chart-item">
                            <div class="donut-chart-title">ETF</div>
                            <div class="donut-chart">
                                <canvas id="etfDonutChart"></canvas>
                            </div>
                        </div>
                        <div class="donut-chart-item">
                            <div class="donut-chart-title">ÏàòÏùµ</div>
                            <div class="donut-chart">
                                <canvas id="etfProfitChart"></canvas>
                            </div>
                        </div>
                        <div class="donut-chart-item">
                            <div class="donut-chart-title">ÎπÑÏ§ë</div>
                            <div class="donut-chart">
                                <canvas id="etfRatioChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="usTab">
                    <div class="donut-charts-container">
                        <div class="donut-chart-item">
                            <div class="donut-chart-title">ÎØ∏Íµ≠</div>
                            <div class="donut-chart">
                                <canvas id="usDonutChart"></canvas>
                            </div>
                        </div>
                        <div class="donut-chart-item">
                            <div class="donut-chart-title">ÏàòÏùµ</div>
                            <div class="donut-chart">
                                <canvas id="usProfitChart"></canvas>
                            </div>
                        </div>
                        <div class="donut-chart-item">
                            <div class="donut-chart-title">ÎπÑÏ§ë</div>
                            <div class="donut-chart">
                                <canvas id="usRatioChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Chart.js ÌîåÎü¨Í∑∏Ïù∏ Îì±Î°ù
        Chart.register(ChartDataLabels);

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentFilter = 'all';
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth() + 1;
        let stockData = {};
        let tradeHistory = {};
        let charts = {};

        // ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ (Ïã§Ï†úÎ°úÎäî APIÏóêÏÑú Í∞ÄÏ†∏Ïò¨ Îç∞Ïù¥ÌÑ∞)
        function generateSampleData() {
            stockData = {
                stocks: [
                    {
                        name: 'ÏÇºÏÑ±Ï†ÑÏûê',
                        quantity: 16,
                        avgPrice: 128523,
                        currentPrice: 152300,
                        profitRate: 18.50,
                        profitAmount: 380428,
                        totalAmount: 2436800
                    },
                    {
                        name: 'SKÌïòÏù¥ÎãâÏä§',
                        quantity: 2,
                        avgPrice: 553000,
                        currentPrice: 755000,
                        profitRate: 36.53,
                        profitAmount: 404000,
                        totalAmount: 1510000
                    },
                    {
                        name: 'LS ELECTRIC',
                        quantity: 2,
                        avgPrice: 491000,
                        currentPrice: 517000,
                        profitRate: 5.30,
                        profitAmount: 52000,
                        totalAmount: 1034000
                    }
                ],
                etfs: [
                    {
                        name: 'Tiger S&P 500',
                        quantity: 43,
                        avgPrice: 25163,
                        currentPrice: 25135,
                        profitRate: -0.11,
                        profitAmount: -1222,
                        totalAmount: 1080805
                    },
                    {
                        name: 'Tiger Î∞òÎèÑÏ≤¥Top10',
                        quantity: 40,
                        avgPrice: 23381,
                        currentPrice: 24275,
                        profitRate: 3.82,
                        profitAmount: 35760,
                        totalAmount: 971000
                    },
                    {
                        name: 'KODEX ÎØ∏Íµ≠ÎÇòÏä§Îã•100',
                        quantity: 39,
                        avgPrice: 24758,
                        currentPrice: 24795,
                        profitRate: 0.15,
                        profitAmount: 1430,
                        totalAmount: 967005
                    }
                ],
                us: [
                    {
                        name: 'Í∏ÄÎ°úÎ≤åÏóëÏä§ Ïö∞ÎùºÎäÑ ETF',
                        quantity: 6,
                        avgPrice: 55.10,
                        currentPrice: 52.92,
                        profitRate: -3.96,
                        profitAmount: -13.08,
                        totalAmount: 317.52
                    },
                    {
                        name: 'Ïä§ÌîÑÎûè Ïö∞ÎùºÎäÑ Í¥ëÏÇ∞ÏóÖ ETF',
                        quantity: 3,
                        avgPrice: 73.24,
                        currentPrice: 68.99,
                        profitRate: -5.80,
                        profitAmount: -12.74,
                        totalAmount: 206.98
                    },
                    {
                        name: 'ÏóêÎ≤ÑÎîò ÏùÄ ÌòÑÎ¨º ETF',
                        quantity: 2,
                        avgPrice: 89.66,
                        currentPrice: 87.87,
                        profitRate: -2.00,
                        profitAmount: -3.59,
                        totalAmount: 175.73
                    }
                ]
            };

            // Í±∞Îûò Í∏∞Î°ù ÏÉòÌîå
            tradeHistory = {
                '2026-01-02': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 3, amount: 920000 }
                ],
                '2026-01-05': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 26, amount: 1020000 }
                ],
                '2026-01-06': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 12, amount: 771000 }
                ],
                '2026-01-07': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 22, amount: 787000 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 22, amount: 222000 }
                ],
                '2026-01-08': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 24, amount: 623000 }
                ],
                '2026-01-09': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 12, amount: 149000 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 8, amount: 99000 }
                ],
                '2026-01-12': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 57, amount: 114500 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 36, amount: 116400 }
                ],
                '2026-01-13': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 47, amount: 97600 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 5, amount: 6300 }
                ],
                '2026-01-14': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 16, amount: 37900 }
                ],
                '2026-01-15': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 10, amount: 17800 }
                ],
                '2026-01-16': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 19, amount: 70000 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 22, amount: 39900 }
                ],
                '2026-01-19': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 19, amount: 70700 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 22, amount: 39900 }
                ],
                '2026-01-20': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 48, amount: 102900 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 11, amount: 70400 }
                ],
                '2026-01-21': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 74, amount: 242000 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 29, amount: 137500 }
                ],
                '2026-01-22': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 49, amount: 130000 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 4, amount: 24600 }
                ],
                '2026-01-23': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 46, amount: 161200 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 19, amount: 47900 }
                ],
                '2026-01-26': [
                    { type: 'buy', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 10, amount: 75100 },
                    { type: 'sell', stock: 'ÏÇºÏÑ±Ï†ÑÏûê', quantity: 10, amount: 72500 }
                ]
            };
        }

        // Ïà´Ïûê Ìè¨Îß∑ Ìï®Ïàò
        function formatNumber(num) {
            return num.toLocaleString();
        }

        // Í∏àÏï° Ìè¨Îß∑ Ìï®Ïàò (ÎßåÏõê Îã®ÏúÑ)
        function formatAmount(amount) {
            if (amount >= 10000) {
                return Math.round(amount / 10000) + 'ÎßåÏõê';
            }
            return Math.round(amount / 1000) / 10 + 'ÎßåÏõê';
        }

        // Îã¨Îü¨ Ìè¨Îß∑ Ìï®Ïàò
        function formatDollar(amount) {
            return '$' + amount.toFixed(2);
        }

        // Îç∞Ïù¥ÌÑ∞ Î†åÎçîÎßÅ
        function renderAccounts() {
            const container = document.getElementById('accountsContainer');
            container.innerHTML = '';

            // Ï£ºÏãù ÏÑπÏÖò
            const stockSection = createAccountSection('Ï¢ÖÎ™©', 'stock', stockData.stocks, 'Ïõê');
            container.appendChild(stockSection);

            // ETF ÏÑπÏÖò
            const etfSection = createAccountSection('ETF', 'etf', stockData.etfs, 'Ïõê');
            container.appendChild(etfSection);

            // ÎØ∏Íµ≠ ÏÑπÏÖò
            const usSection = createAccountSection('ÎØ∏Íµ≠', 'us', stockData.us, '$');
            container.appendChild(usSection);
        }

        // Í≥ÑÏ†ï ÏÑπÏÖò ÏÉùÏÑ±
        function createAccountSection(title, type, items, currency) {
            const section = document.createElement('div');
            section.className = 'account-section';

            const header = document.createElement('div');
            header.className = 'account-title';
            header.innerHTML = `<span class="account-icon ${type}"></span>${title}`;
            section.appendChild(header);

            items.forEach(item => {
                const stockItem = document.createElement('div');
                stockItem.className = 'stock-item';
                stockItem.onclick = () => selectStock(item.name);

                const changeClass = item.profitRate >= 0 ? 'positive' : 'negative';
                const profitClass = item.profitAmount >= 0 ? 'positive' : 'negative';

                let avgPriceText, currentPriceText, profitAmountText, totalAmountText;
                if (currency === '$') {
                    avgPriceText = formatDollar(item.avgPrice);
                    currentPriceText = formatDollar(item.currentPrice);
                    profitAmountText = formatDollar(Math.abs(item.profitAmount));
                    totalAmountText = formatDollar(item.totalAmount);
                } else {
                    avgPriceText = formatNumber(item.avgPrice) + 'Ïõê';
                    currentPriceText = formatNumber(item.currentPrice) + 'Ïõê';
                    profitAmountText = formatNumber(Math.abs(item.profitAmount)) + 'Ïõê';
                    totalAmountText = formatNumber(item.totalAmount) + 'Ïõê';
                }

                stockItem.innerHTML = `
                    <div class="stock-name">
                        <span>${item.name}</span>
                        <span class="stock-change ${changeClass}">${item.profitRate >= 0 ? '+' : ''}${item.profitRate.toFixed(2)}%</span>
                    </div>
                    <div class="stock-details">
                        <div class="detail-item">
                            <span>Î≥¥Ïú†ÏàòÎüâ</span>
                            <span class="detail-value">${item.quantity}${currency === '$' ? '' : 'Ï£º'}</span>
                        </div>
                        <div class="detail-item">
                            <span>ÌèâÍ∑†Îã®Í∞Ä</span>
                            <span class="detail-value">${avgPriceText}</span>
                        </div>
                        <div class="detail-item">
                            <span>Ï†ÑÏùºÏ¢ÖÍ∞Ä</span>
                            <span class="detail-value">${currentPriceText}</span>
                        </div>
                        <div class="detail-item profit-loss ${profitClass}">
                            <span>ÌèâÍ∞ÄÏÜêÏùµ</span>
                            <span class="detail-value">${item.profitAmount >= 0 ? '+' : '-'}${profitAmountText}</span>
                        </div>
                        <div class="detail-item">
                            <span>ÌèâÍ∞ÄÍ∏àÏï°</span>
                            <span class="detail-value">${totalAmountText}</span>
                        </div>
                    </div>
                `;
                section.appendChild(stockItem);
            });

            return section;
        }

        // Ï¢ÖÎ™© ÏÑ†ÌÉù
        function selectStock(stockName) {
            currentFilter = stockName;
            document.getElementById('currentStockName').textContent = stockName;

            // ÌïÑÌÑ∞ Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('allFilterBtn').classList.remove('active');
            document.getElementById('allFilterBtn').textContent = 'Ï†ÑÏ≤¥';

            updateCalendar();
            renderTradeHistory(stockName);
        }

        // Ï†ÑÏ≤¥ ÌïÑÌÑ∞ ÏÑ†ÌÉù
        function selectFilter(filter) {
            if (filter === 'all') {
                currentFilter = 'all';
                document.getElementById('currentStockName').textContent = 'Ï†ÑÏ≤¥';
                document.getElementById('allFilterBtn').classList.add('active');
                updateCalendar();
                renderTradeHistory('all');
            }
        }

        // Í±∞Îûò ÎÇ¥Ïó≠ Î†åÎçîÎßÅ
        function renderTradeHistory(filter) {
            const title = document.getElementById('tradeHistoryTitle');
            const list = document.getElementById('tradeHistoryList');

            title.textContent = filter === 'all' ? 'Ï¢ÖÎ™©Î≥Ñ Í±∞Îûò ÎÇ¥Ïó≠' : `${filter} Í±∞Îûò ÎÇ¥Ïó≠`;
            list.innerHTML = '';

            // ÎÇ†ÏßúÎ≥ÑÎ°ú Í±∞Îûò Ï†ïÎ†¨
            const sortedDates = Object.keys(tradeHistory).sort((a, b) => new Date(b) - new Date(a));

            sortedDates.forEach(date => {
                const trades = tradeHistory[date].filter(trade => 
                    filter === 'all' || trade.stock === filter
                );

                trades.forEach(trade => {
                    const item = document.createElement('div');
                    item.className = `trade-history-item ${trade.type}`;

                    item.innerHTML = `
                        <div class="trade-date">${date}</div>
                        <div class="trade-details">
                            <span>${trade.type === 'buy' ? 'Îß§Ïàò' : 'Îß§ÎèÑ'} ${trade.quantity}Ï£º</span>
                            <span>${formatAmount(trade.amount)}</span>
                        </div>
                    `;

                    list.appendChild(item);
                });
            });
        }

        // Ï∫òÎ¶∞Îçî Ï¥àÍ∏∞Ìôî
        function initCalendar() {
            const yearSelect = document.getElementById('yearSelect');
            const monthSelect = document.getElementById('monthSelect');

            // ÎÖÑÎèÑ ÏòµÏÖò (ÌòÑÏû¨ÎÖÑ ¬±2)
            for (let year = currentYear - 2; year <= currentYear + 2; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'ÎÖÑ';
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }

            // Ïõî ÏòµÏÖò
            for (let month = 1; month <= 12; month++) {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month + 'Ïõî';
                if (month === currentMonth) option.selected = true;
                monthSelect.appendChild(option);
            }

            updateCalendar();
        }

        // Ï∫òÎ¶∞Îçî ÏóÖÎç∞Ïù¥Ìä∏
        function updateCalendar() {
            const year = parseInt(document.getElementById('yearSelect').value);
            const month = parseInt(document.getElementById('monthSelect').value);

            currentYear = year;
            currentMonth = month;

            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);

            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            // 6Ï£º ÌëúÏãú
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);

                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';

                if (date.getMonth() !== month - 1) {
                    dayElement.classList.add('other-month');
                }

                const dateString = date.toISOString().split('T')[0];
                const dayNumber = date.getDate();

                dayElement.innerHTML = `<div class="day-number">${dayNumber}</div>`;

                // Í±∞Îûò Ï†ïÎ≥¥ ÌëúÏãú
                if (tradeHistory[dateString]) {
                    const trades = tradeHistory[dateString].filter(trade => 
                        currentFilter === 'all' || trade.stock === currentFilter
                    );

                    trades.forEach(trade => {
                        const tradeInfo = document.createElement('div');
                        tradeInfo.className = `trade-info ${trade.type}`;
                        tradeInfo.textContent = `${trade.type === 'buy' ? 'Îß§Ïàò' : 'Îß§ÎèÑ'} ${trade.quantity}Ï£º/${formatAmount(trade.amount)}`;
                        dayElement.appendChild(tradeInfo);
                    });
                }

                calendarGrid.appendChild(dayElement);
            }

            updateMonthlySummary();
        }

        // ÏõîÎ≥Ñ ÏöîÏïΩ ÏóÖÎç∞Ïù¥Ìä∏
        function updateMonthlySummary() {
            let totalBuy = 0;
            let totalSell = 0;

            Object.keys(tradeHistory).forEach(date => {
                const [year, month] = date.split('-').map(Number);
                if (year === currentYear && month === currentMonth) {
                    tradeHistory[date].forEach(trade => {
                        if (currentFilter === 'all' || trade.stock === currentFilter) {
                            if (trade.type === 'buy') totalBuy += trade.amount;
                            else totalSell += trade.amount;
                        }
                    });
                }
            });

            document.getElementById('totalBuy').textContent = formatAmount(totalBuy);
            document.getElementById('totalSell').textContent = formatAmount(totalSell);
        }

        // Ïõî Ïù¥Îèô
        function prevMonth() {
            if (currentMonth === 1) {
                currentMonth = 12;
                currentYear--;
            } else {
                currentMonth--;
            }
            document.getElementById('yearSelect').value = currentYear;
            document.getElementById('monthSelect').value = currentMonth;
            updateCalendar();
        }

        function nextMonth() {
            if (currentMonth === 12) {
                currentMonth = 1;
                currentYear++;
            } else {
                currentMonth++;
            }
            document.getElementById('yearSelect').value = currentYear;
            document.getElementById('monthSelect').value = currentMonth;
            updateCalendar();
        }

        // ÌÉ≠ Ï†ÑÌôò
        function showTab(tabName) {
            // ÌÉ≠ Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // ÌÉ≠ ÏΩòÌÖêÏ∏† ÌëúÏãú
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');

            // Ï∞®Ìä∏ Î†åÎçîÎßÅ
            renderCharts(tabName);
        }

        // ÎèÑÎÑõ Ï∞®Ìä∏ Î†åÎçîÎßÅ
        function renderCharts(type) {
            // Í∏∞Ï°¥ Ï∞®Ìä∏ Ï†úÍ±∞
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};

            let data, labels;
            if (type === 'stock') {
                data = stockData.stocks.map(item => item.totalAmount);
                labels = stockData.stocks.map(item => item.name);
            } else if (type === 'etf') {
                data = stockData.etfs.map(item => item.totalAmount);
                labels = stockData.etfs.map(item => item.name);
            } else {
                data = stockData.us.map(item => item.totalAmount);
                labels = stockData.us.map(item => item.name);
            }

            // Í∏∞Î≥∏ ÎèÑÎÑõ Ï∞®Ìä∏
            const donutCtx = document.getElementById(type + 'DonutChart').getContext('2d');
            charts[type + 'Donut'] = new Chart(donutCtx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        datalabels: {
                            color: '#fff',
                            formatter: (value, ctx) => {
                                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = (value / total * 100).toFixed(1);
                                return percentage + '%';
                            }
                        }
                    }
                }
            });

            // ÏàòÏùµ Ï∞®Ìä∏
            const profitData = type === 'us' 
                ? (type === 'us' ? stockData.us.map(item => Math.abs(item.profitAmount)) : [])
                : (type === 'stock' ? stockData.stocks.map(item => Math.abs(item.profitAmount)) : stockData.etfs.map(item => Math.abs(item.profitAmount)));

            const profitCtx = document.getElementById(type + 'ProfitChart').getContext('2d');
            charts[type + 'Profit'] = new Chart(profitCtx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: profitData,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        datalabels: {
                            color: '#fff',
                            formatter: (value, ctx) => {
                                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = (value / total * 100).toFixed(1);
                                return percentage + '%';
                            }
                        }
                    }
                }
            });

            // ÎπÑÏ§ë Ï∞®Ìä∏ (ÎèôÏùº Îç∞Ïù¥ÌÑ∞Î°ú ÌëúÏãú)
            const ratioCtx = document.getElementById(type + 'RatioChart').getContext('2d');
            charts[type + 'Ratio'] = new Chart(ratioCtx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        datalabels: {
                            color: '#fff',
                            formatter: (value, ctx) => {
                                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = (value / total * 100).toFixed(1);
                                return percentage + '%';
                            }
                        }
                    }
                }
            });
        }

        // Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
        function refreshData() {
            generateSampleData();
            renderAccounts();
            renderTradeHistory(currentFilter);
            updateCalendar();
            renderCharts('stock');
        }

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', () => {
            generateSampleData();
            renderAccounts();
            initCalendar();
            renderTradeHistory('all');
            renderCharts('stock');
        });
    </script>
</body>
</html>
